---
import Pagination from '../components/products/Pagination.astro'
import ProductListing2D, {
  type Product,
} from '../components/products/ProductListing2D.astro'
import ProductLayout from '../layouts/ProductLayout.astro'
import pb, { filecdn } from '../lib/pb'
import type { RecordModel } from 'pocketbase'

const {
  items: records,
  page,
  perPage,
  totalPages,
  totalItems,
} = await pb.collection('FURNITURE').getList(1, 20)

const products: Product[] = records.map((r: RecordModel) => ({
  name: r.Name,
  image: filecdn(r.collectionId, r.id, r.Image[0]),
  model: r.Model,
  id: r.id,
  alt_text: `${r.Name} | ${r.Model}`,
}))

const need_pagination = totalItems > perPage
---

<ProductLayout>
  <ProductListing2D {products} />
  {need_pagination && <Pagination {totalPages} currentPage={page} {perPage} />}

</ProductLayout>
